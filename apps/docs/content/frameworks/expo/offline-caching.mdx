---
title: Offline & Caching
description: How persistent caching and offline fallback works in @better-i18n/expo
---

# Offline & Caching

Mobile apps need to work without network. `@better-i18n/expo` uses a **network-first** strategy with persistent storage so your app always gets fresh translations — and never crashes when the CDN is unavailable.

## How It Works

When you call `initBetterI18n()` or `changeLanguage()`, the SDK follows this flow:

```
initBetterI18n() / changeLanguage()
│
├─ 1. Resource check (hasResourceBundle?)
│     └─ Already loaded? → Skip fetch, switch instantly
│
├─ 2. CDN fetch (network-first)
│     ├─ Success → Inject resources + write to persistent cache
│     └─ Failure ↓
│
├─ 3. Persistent cache (MMKV / AsyncStorage)
│     ├─ Cached? → Inject resources, switch language
│     └─ No cache ↓
│
└─ 4. Static data (if configured)
      ├─ Has locale? → Use bundled translations
      └─ No data → i18next uses fallbackLng (graceful degradation)
```

<Callout type="tip">
  **Key guarantee:** If the user has opened the app at least once with network, the app will always have translations available — even in airplane mode.
</Callout>

## Cache Layers

### 1. Resource Store (In-Memory)

The fastest layer. Once translations are loaded into i18next's resource store, subsequent `changeLanguage()` calls skip the CDN entirely.

- Survives navigation and re-renders
- Cleared when the app is killed
- Checked via `hasResourceBundle()` before any network call

### 2. Persistent Cache

Translations are persisted to device storage so they survive app restarts. Used as **offline fallback** when the CDN is unreachable.

**Storage keys (per locale):**
```
@better-i18n:{project}:{locale}:translations  → JSON translation data
@better-i18n:{project}:{locale}:meta           → { cachedAt: timestamp }
```

Each locale has a single cache entry that gets overwritten on every successful CDN fetch — no duplicate entries.

### 3. Static Data (Bundled Fallback)

For airplane mode on first launch where there's no CDN and no cache, you can bundle translations directly in your app:

```ts
await initBetterI18n({
  project: 'your-org/your-project',
  i18n: i18n.use(initReactI18next),
  staticData: {
    en: { common: { welcome: 'Welcome' } },
    tr: { common: { welcome: 'Hoş geldiniz' } },
  },
});
```

<Callout type="info">
  `staticData` is your last-resort fallback. Useful for airplane mode first launch where there's no CDN and no cache yet. These translations are passed to `@better-i18n/core` and used only when both CDN and persistent cache fail.
</Callout>

## Storage Auto-Detection

Storage is resolved automatically at startup. Zero config required.

| Priority | Storage | Speed | Persistence |
|----------|---------|-------|-------------|
| 1 | `react-native-mmkv` | Sync I/O, fastest | Yes |
| 2 | `@react-native-async-storage/async-storage` | Async | Yes |
| 3 | In-memory `Map` | Instant | No |

If you have `react-native-mmkv` installed, it's used automatically (separate MMKV instance with id `"better-i18n"`). Otherwise, AsyncStorage is used. If neither is installed, falls back to in-memory (no offline support).

## Custom Storage

You can provide any storage that implements the `TranslationStorage` interface:

```ts
await initBetterI18n({
  project: 'acme/app',
  i18n,
  storage: {
    getItem: async (key: string) => /* ... */,
    setItem: async (key: string, value: string) => /* ... */,
    removeItem: async (key: string) => /* ... */,
  },
});
```

### In-Memory Only

For testing or when you don't want persistence:

```ts
import { createMemoryStorage } from '@better-i18n/expo';

await initBetterI18n({
  project: 'acme/app',
  i18n,
  storage: createMemoryStorage(),
});
```

## Without Persistent Storage

If neither MMKV nor AsyncStorage is installed, the SDK automatically falls back to in-memory storage. This means:

- Translations are fetched from CDN on every app launch
- No offline support between sessions
- Works fine for development and testing

<Callout type="warning">
  For production apps, install `react-native-mmkv` or `@react-native-async-storage/async-storage` for offline support.
</Callout>
